# 13. **Working with APIs (Application Programming Interfaces)**

APIs allow different software systems to communicate with each other, enabling you to integrate external data and functionality into your Python programs. In Python, working with APIs is straightforward, thanks to libraries like `requests` for making HTTP requests and `json` for handling JSON data.

## **1. What is an API?**

An **API** is a set of rules that allow one piece of software or program to communicate with another. APIs can expose data, functionalities, or services to be consumed by other applications. The most common type of API interaction is through **HTTP requests** to **web APIs**.

For example, when you request data from a weather website or get information from a social media platform, you are likely interacting with an API.

## **2. Making HTTP Requests with `requests`**

The `requests` library is a simple, yet powerful, way to send HTTP requests and handle responses. To install `requests`, you can run:

```bash
pip install requests
```

### **Making a GET Request**

A **GET request** is used to retrieve data from a specified resource.

```python
import requests

response = requests.get("https://api.github.com")
print(response.status_code)  # Output: 200 (Success)
print(response.json())  # Output: JSON data returned by the API
```

In this example, the `GET` request is made to the GitHub API, and the response's status code and JSON content are printed.

### **Making a POST Request**

A **POST request** is used to send data to a server to create or update a resource.

```python
import requests

url = "https://jsonplaceholder.typicode.com/posts"
data = {
    "title": "foo",
    "body": "bar",
    "userId": 1
}
response = requests.post(url, json=data)

print(response.status_code)  # Output: 201 (Created)
print(response.json())  # Output: JSON data returned by the API
```

In this case, we're sending a JSON payload with the `POST` request to create a new post on the example API.

## **3. Handling API Responses**

API responses can contain data in various formats, but the most common is **JSON**. Python's `requests` library can automatically parse JSON data, making it easy to work with.

### **Example: Working with JSON Data**

```python
import requests

url = "https://jsonplaceholder.typicode.com/posts"
response = requests.get(url)

# Parse JSON response
data = response.json()

# Access specific data
for post in data:
    print(f"Title: {post['title']}")
```

In this example, we send a `GET` request to an API and parse the response as JSON. We then loop through the posts and print each post's title.

## **4. Sending Headers and Parameters**

Sometimes, APIs require additional information in the form of **headers** (for authentication or content type) or **parameters** (to filter or modify the data).

### **Adding Headers to a Request**

```python
import requests

url = "https://api.github.com/user"
headers = {"Authorization": "Bearer YOUR_TOKEN_HERE"}

response = requests.get(url, headers=headers)
print(response.json())
```

In this example, an **Authorization** header is included in the `GET` request to authenticate the request with an API token.

### **Adding URL Parameters**

```python
import requests

url = "https://api.openweathermap.org/data/2.5/weather"
params = {"q": "London", "appid": "YOUR_API_KEY"}

response = requests.get(url, params=params)
print(response.json())
```

Here, we are sending a `GET` request to the OpenWeather API with a query parameter (`q`) for the city and an API key (`appid`) for authentication.

## **5. Handling Errors in API Requests**

Sometimes, the request may fail due to network issues or incorrect API calls. It's important to handle errors gracefully using status codes and exception handling.

### **Handling HTTP Errors**

```python
import requests

url = "https://api.github.com/invalid_endpoint"
response = requests.get(url)

if response.status_code == 200:
    print("Request was successful")
else:
    print(f"Error {response.status_code}: {response.reason}")
```

* **Common HTTP Status Codes**:

  * `200`: OK (The request was successful)
  * `201`: Created (The resource was created)
  * `400`: Bad Request (There was an issue with the request)
  * `401`: Unauthorized (Authentication is required)
  * `404`: Not Found (The resource could not be found)
  * `500`: Internal Server Error (The server encountered an error)

### **Handling Exceptions**

```python
import requests

url = "https://api.github.com/invalid_endpoint"

try:
    response = requests.get(url)
    response.raise_for_status()  # Raises an exception for HTTP errors
except requests.exceptions.HTTPError as err:
    print(f"HTTP error occurred: {err}")
except Exception as err:
    print(f"An error occurred: {err}")
```

## **6. Authentication with APIs**

Many APIs require authentication to access their resources. Common authentication methods include **API keys**, **OAuth**, and **Bearer tokens**.

### **Example: Using an API Key for Authentication**

```python
import requests

url = "https://api.example.com/data"
params = {"api_key": "YOUR_API_KEY"}

response = requests.get(url, params=params)
print(response.json())
```

In this case, the `api_key` is passed as a query parameter to authenticate the request.

## **7. Rate Limiting**

Many APIs have rate limits that restrict how many requests you can make in a given time period. It’s important to check the API’s documentation to understand these limits and handle them appropriately.

You can usually check the rate limit status in the API’s response headers.

```python
import requests

url = "https://api.github.com/rate_limit"
response = requests.get(url)

rate_limit = response.json()
print(rate_limit)
```

The above request fetches the rate limit status from GitHub’s API.

---

### **Why Work with APIs?**

* **Access to External Data**: APIs allow you to interact with external data sources such as weather data, financial information, social media data, and more.
* **Integration**: APIs enable you to integrate third-party services and functionalities into your application (e.g., payment gateways, authentication systems).
* **Automation**: APIs are useful for automating repetitive tasks, such as data collection or reporting, without manual intervention.

Mastering API integration is key for building dynamic applications that interact with external services and data. Whether you're pulling data from a weather API or integrating with a payment gateway, Python's tools for working with APIs make it straightforward to connect with the wider web.
